<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,user-scalable=no, width=device-width, height=device-height, viewport-fit=cover">
     <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: gap://ready file://* ws: wss: http: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; style-src 'self' 'unsafe-inline' data: blob:; img-src 'self' data: blob: http: https:; font-src 'self' data: blob:; connect-src 'self' ws: wss: http: https:; object-src 'none'; base-uri 'self'; form-action 'self';"> 
    <title>Trudesk Mobile</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Override localStorage globally to prevent security errors -->
    <script>
      // Define safari variable early for compatibility
      window.safari = window.safari || {};
      
      // Override global variables that might cause errors
      if (typeof safari === 'undefined') {
        window.safari = {};
      }
      
      // Override localStorage globally to prevent "The operation is insecure" errors
      (function() {
        // Store original localStorage methods safely
        var originalLocalStorage = {};
        try {
          originalLocalStorage = {
            getItem: localStorage.getItem.bind(localStorage),
            setItem: localStorage.setItem.bind(localStorage),
            removeItem: localStorage.removeItem.bind(localStorage),
            clear: localStorage.clear.bind(localStorage)
          };
        } catch (e) {
          // If localStorage is not available, create dummy methods
          originalLocalStorage = {
            getItem: function() { return null; },
            setItem: function() { return false; },
            removeItem: function() { return false; },
            clear: function() { return false; }
          };
        }

        // Create safe wrapper
        var safeLocalStorage = {
          getItem: function(key) {
            try {
              return originalLocalStorage.getItem(key);
            } catch (e) {
              console.warn('localStorage get error:', e.message);
              return null;
            }
          },
          setItem: function(key, value) {
            try {
              originalLocalStorage.setItem(key, value);
              return true;
            } catch (e) {
              console.warn('localStorage set error:', e.message);
              return false;
            }
          },
          removeItem: function(key) {
            try {
              originalLocalStorage.removeItem(key);
              return true;
            } catch (e) {
              console.warn('localStorage remove error:', e.message);
              return false;
            }
          },
          clear: function() {
            try {
              originalLocalStorage.clear();
              return true;
            } catch (e) {
              console.warn('localStorage clear error:', e.message);
              return false;
            }
          }
        };

        // Override localStorage methods
        try {
          Object.defineProperty(window, 'localStorage', {
            value: safeLocalStorage,
            writable: false,
            configurable: false
          });
        } catch (e) {
          // Fallback for browsers that don't support Object.defineProperty
          window.localStorage = safeLocalStorage;
        }

        // Also override sessionStorage
        var originalSessionStorage = {};
        try {
          originalSessionStorage = {
            getItem: sessionStorage.getItem.bind(sessionStorage),
            setItem: sessionStorage.setItem.bind(sessionStorage),
            removeItem: sessionStorage.removeItem.bind(sessionStorage),
            clear: sessionStorage.clear.bind(sessionStorage)
          };
        } catch (e) {
          // If sessionStorage is not available, create dummy methods
          originalSessionStorage = {
            getItem: function() { return null; },
            setItem: function() { return false; },
            removeItem: function() { return false; },
            clear: function() { return false; }
          };
        }

        var safeSessionStorage = {
          getItem: function(key) {
            try {
              return originalSessionStorage.getItem(key);
            } catch (e) {
              console.warn('sessionStorage get error:', e.message);
              return null;
            }
          },
          setItem: function(key, value) {
            try {
              originalSessionStorage.setItem(key, value);
              return true;
            } catch (e) {
              console.warn('sessionStorage set error:', e.message);
              return false;
            }
          },
          removeItem: function(key) {
            try {
              originalSessionStorage.removeItem(key);
              return true;
            } catch (e) {
              console.warn('sessionStorage remove error:', e.message);
              return false;
            }
          },
          clear: function() {
            try {
              originalSessionStorage.clear();
              return true;
            } catch (e) {
              console.warn('sessionStorage clear error:', e.message);
              return false;
            }
          }
        };

        try {
          Object.defineProperty(window, 'sessionStorage', {
            value: safeSessionStorage,
            writable: false,
            configurable: false
          });
        } catch (e) {
          // Fallback for browsers that don't support Object.defineProperty
          window.sessionStorage = safeSessionStorage;
        }

        // Override any remaining storage access that might cause issues
        try {
          // Override any direct storage access
          if (window.localStorage) {
            window.localStorage = safeLocalStorage;
          }
          if (window.sessionStorage) {
            window.sessionStorage = safeSessionStorage;
          }
        } catch (e) {
          console.warn('Could not override storage:', e.message);
        }
        
        console.log('localStorage and sessionStorage overridden with safe implementation');
      })();
    </script>

    <!-- compiled css output -->
    <link href="css/ionic.app.css" rel="stylesheet">
    
    <!-- Fonts are loaded via CSS, no need to preload -->
    
    <!-- Prevent layout shift by hiding content until loaded -->
    <style>
      body { visibility: hidden; }
      body.loaded { visibility: visible; }
    </style>

    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>

    <script src="lib/ngCordova/dist/ng-cordova.min.js"></script>

    <script src="lib/ngstorage/ngStorage.min.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <!-- <script src="cordova.js"></script> -->

    <!--ionic filter plugin-->
    <link rel="stylesheet" href="lib/ionic-filter-bar/dist/ionic.filter.bar.css">
    <script src="lib/ionic-filter-bar/dist/ionic.filter.bar.js" charset="utf-8"></script>

    <!-- Libs -->
    <script src="lib/socket.io-client/dist/socket.io.min.js" charset="utf-8"></script>
    <script src="lib/jquery/dist/jquery.min.js" charset="utf-8"></script>
    <script src="lib/underscore/underscore-min.js" charset="utf-8"></script>
    <script src="lib/d3/d3.min.js" charset="utf-8"></script>
    <script src="lib/c3/c3.min.js"></script>
    <link rel="stylesheet" href="lib/c3/c3.min.css">
    <script src="lib/peity/jquery.peity.min.js"></script>
    <link rel="stylesheet" href="lib/snackbar/dist/snackbar.css">
    <script src="lib/snackbar/dist/snackbar.js" charset="utf-8"></script>
    <script src="lib/ng-cropper/dist/ngCropper.all.js" charset="utf-8"></script>
    <link rel="stylesheet" href="lib/ng-cropper/dist/ngCropper.all.css">
    <!-- <script src="lib/cropperjs/dist/cropper.min.js"></script> -->
    <!-- <link rel="stylesheet" href="lib/cropperjs/dist/cropper.min.css" /> -->
    <script src="lib/angular-elastic/elastic.js" charset="utf-8"></script>
    <script src="lib/Autolinker.js/dist/Autolinker.min.js" charset="utf-8"></script>
    <script src="lib/moment/min/moment.min.js" charset="utf-8"></script>
    <script src="lib/angular-moment/angular-moment.min.js" charset="utf-8"></script>
    <script src="lib/angular-img-http-src/index.js" charset="utf-8"></script>


    <!-- your app's js -->
    <script src="js/dist/td.app.min.js"></script>
    
    <!-- Show content after everything is loaded -->
    <script>
      // Global error handler to catch any remaining errors
      window.addEventListener('error', function(e) {
        console.warn('Caught error:', e.message, e.filename, e.lineno);
        // Don't prevent default to avoid breaking the app
      });
      
      // Handle unhandled promise rejections
      window.addEventListener('unhandledrejection', function(e) {
        console.warn('Unhandled promise rejection:', e.reason);
        e.preventDefault(); // Prevent the error from showing in console
      });
      
      window.addEventListener('load', function() {
        document.body.classList.add('loaded');
      });
    </script>
  </head>
  <body ng-app="trudesk">
    <div class="mobile-container">
    <div id="loader"></div>
      <ion-nav-bar class="bar-dark nav-title-slide-ios7">
        <ion-nav-back-button>
        </ion-nav-back-button>
      </ion-nav-bar>

      <ion-nav-view></ion-nav-view>
    </div>
  </body>
</html>
